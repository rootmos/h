#!/bin/bash

set -o nounset -o pipefail -o errexit

INSTALL=${INSTALL-}
while getopts "i-" OPT; do
    case $OPT in
        i) INSTALL=1 ;;
        -) break ;;
        ?) exit 2 ;;
    esac
done
shift $((OPTIND-1))

PKGS=($( (dpkg-checkbuilddeps 2>&1 || true) \
    | sed 's/dpkg-checkbuilddeps:\serror:\sUnmet build dependencies: //g' \
    | sed 's/[\(][^)]*[\)] //g'))

[ "${#PKGS[@]}" -eq 0 ] && exit 0

if [ -n "$INSTALL" ]; then
    apt-get install -y "${PKGS[@]}"
else
    echo "${PKGS[@]}"
fi
